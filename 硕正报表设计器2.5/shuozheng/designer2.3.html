<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<TITLE>报表设计器</TITLE>

<link rel="stylesheet" type="text/css" href="/dojo/resources/dojo.css" />
<link rel="stylesheet" type="text/css"
	href="/dojox/grid/resources/Grid.css" />
<link rel="stylesheet" type="text/css"
	href="/dojox/grid/resources/soriaGrid.css" />
<link rel="stylesheet" type="text/css"
	href="/dijit/themes/soria/soria.css" />
<link rel="stylesheet" type="text/css"
	href="/dojox/layout/resources/ToggleSplitter.css" />
<style type="text/css">
@import "/dojox/grid/enhanced/resources/EnhancedGrid.css";
@import "/dojox/grid/enhanced/resources/EnhancedGrid_rtl.css";
html,body {
	width: 100%;
	height: 100%;
	overflow: hidden;
	padding: 0;
	margin: 0;
}

#_main {
	height: 100%;
	width: 100%;
	font-size: 12px;
}

#_main_center {
	height: 100%;
	width: 100%;
	margin: 0;
	padding: 0px;
}

#_main_grid {
	height: 100%;
}
</style>
<script type="text/javascript">
	var djConfig = {
		async : true,
		bindEncoding : "UTF-8",
		packages : [ {
			name : "fore",
			location : "http://localhost:8083/dojoxx/fore"
		} ]
	};
</script>

<script type="text/javascript" src="/dojo/dojo.js"
	data-dojo-config="isDebug:false,parseOnLoad:true"></script>
<script type='text/javascript' src='dynaload.js?72'></script>
<script type="text/javascript">
	var OnReady = function() {
		console.log("ShuoZhengOnReady");
		var xml = "<?xml version='1.0' encoding='UTF-8' ?><!--By Supcan Report --><Report>	<WorkSheet name='演示表' isDefaultPrint='true'>		<Properties>			<BackGround bgColor='#F3F3F3' arrange='tile' alpha='255' />			<DefaultTD>				<TD fontIndex='0' textColor='#000000' transparent='true'					leftBorder='0' topBorder='0' leftBorderColor='#C0C0C0'					leftBorderStyle='solid' topBorderColor='#C0C0C0' topBorderStyle='solid'					decimal='2' align='left' vAlign='middle' isProtected='false'					isThousandSeparat='true' isRound='true' isPrint='true' />			</DefaultTD>			<Other isShowZero='true' isRefOriPrecision='true' LineDistance='0'				isRowHeightAutoExtendAble='true' />		</Properties>		<Fonts>			<Font faceName='Verdana' height='-13' weight='400'				pitchAndFamily='2' quality='1' outPrecision='3' clipPrecision='2' />			<Font faceName='Verdana' height='-13' weight='700' />			<Font faceName='Verdana' height='-13' weight='400' />			<Font faceName='Verdana' height='-13' weight='700'				pitchAndFamily='2' quality='1' outPrecision='3' clipPrecision='2' />			<Font faceName='宋体' height='-13' weight='400' pitchAndFamily='2'				quality='1' outPrecision='3' clipPrecision='2' />			<Font faceName='宋体' height='-13' weight='400' />			<Font faceName='楷体' charSet='134' height='-27' weight='700' />		</Fonts>		<Table>			<Col width='19' />			<Col width='102' />			<Col width='194' />			<Col width='117' />			<Col width='144' />			<Col width='13' />			<TR height='46' sequence='0'>				<TD fontIndex='6' align='center'>11长风公司订单明细表</TD>				<TD fontIndex='6' leftBorder='1' align='center' />				<TD fontIndex='6' leftBorder='1' align='center' />				<TD fontIndex='6' leftBorder='1' align='center' />				<TD fontIndex='6' leftBorder='1' align='center' />				<TD fontIndex='6' leftBorder='1' align='center' />			</TR>			<TR height='23' sequence='1'>				<TD fontIndex='1' />				<TD fontIndex='1'>订单:1</TD>				<TD fontIndex='1' leftBorder='1' topBorder='1' />				<TD fontIndex='1' />				<TD fontIndex='1' align='center' datatype='1' />				<TD fontIndex='1' />			</TR>			<TR height='23' sequence='2'>				<TD fontIndex='2' />				<TD fontIndex='1' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1' />				<TD fontIndex='1' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>说明</TD>				<TD fontIndex='1' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>日期</TD>				<TD fontIndex='1' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>日志</TD>				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='23' sequence='3'>				<TD fontIndex='2' />				<TD fontIndex='2' leftBorder='1' topBorder='1' datatype='1' />				<TD fontIndex='2' leftBorder='1' topBorder='1' datatype='1'>1</TD>				<TD fontIndex='2' leftBorder='1' topBorder='1' align='center'					datatype='1' />				<TD fontIndex='2' leftBorder='1' topBorder='1' datatype='1' />				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='23' sequence='4'>				<TD fontIndex='2' />				<TD fontIndex='2' topBorder='1' />				<TD fontIndex='2' topBorder='1' />				<TD fontIndex='2' topBorder='1' />				<TD fontIndex='2' topBorder='1' align='center' />				<TD fontIndex='2' />			</TR>			<TR height='23' sequence='5'>				<TD fontIndex='3' />				<TD fontIndex='3'>定单产品列表:</TD>				<TD fontIndex='3' decimal='0' isThousandSeparat='false' />				<TD fontIndex='3' />				<TD fontIndex='3' align='center' />				<TD fontIndex='1' />			</TR>			<TR height='23' sequence='6'>				<TD />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' isThousandSeparat='false' datatype='1' />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>规格</TD>				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>供应商</TD>				<TD fontIndex='3' leftBorder='1' topBorder='1' align='center' />				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='23' sequence='7'>				<TD />				<TD leftBorder='1' topBorder='1' isThousandSeparat='false'					datatype='1' />				<TD leftBorder='1' topBorder='1' datatype='1' />				<TD leftBorder='1' topBorder='1' datatype='1' />				<TD leftBorder='1' topBorder='1' align='center' />				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='23' sequence='8'>				<TD />				<TD topBorder='1' />				<TD topBorder='1' />				<TD topBorder='1' />				<TD topBorder='1' align='center' />				<TD fontIndex='2' />			</TR>			<TR height='23' sequence='9'>				<TD fontIndex='3' />				<TD fontIndex='3'>定单子产品列表:</TD>				<TD fontIndex='3' decimal='0' isThousandSeparat='false' />				<TD fontIndex='3' />				<TD fontIndex='3' align='center' />				<TD fontIndex='1' />			</TR>			<TR height='23' sequence='10'>				<TD />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' isThousandSeparat='false' datatype='1' />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>产品规格</TD>				<TD fontIndex='3' leftBorder='1' topBorder='1' align='center' />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>数量</TD>				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='23' sequence='11'>				<TD />				<TD leftBorder='1' topBorder='1' isThousandSeparat='false'					datatype='1' />				<TD leftBorder='1' topBorder='1' datatype='1' />				<TD leftBorder='1' topBorder='1' align='right' />				<TD leftBorder='1' topBorder='1' align='right' datatype='6' />				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='23' sequence='12'>				<TD />				<TD topBorder='1' />				<TD topBorder='1' />				<TD topBorder='1' />				<TD topBorder='1' align='center' />				<TD fontIndex='2' />			</TR>			<TR height='23' sequence='13'>				<TD fontIndex='3' />				<TD fontIndex='3'>定单客户情况:</TD>				<TD fontIndex='3' decimal='0' isThousandSeparat='false' />				<TD fontIndex='3' />				<TD fontIndex='3' align='center' />				<TD fontIndex='1' />			</TR>			<TR height='23' sequence='14'>				<TD />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' isThousandSeparat='false' datatype='1' />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>用户名</TD>				<TD fontIndex='3' leftBorder='1' topBorder='1' align='center' />				<TD fontIndex='3' bgColor='#E0E0E0' leftBorder='1' topBorder='1'					align='center' datatype='1'>电话</TD>				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='23' sequence='15'>				<TD />				<TD leftBorder='1' topBorder='1' isThousandSeparat='false'					datatype='1' />				<TD leftBorder='1' topBorder='1' datatype='1' />				<TD leftBorder='1' topBorder='1' />				<TD leftBorder='1' topBorder='1' align='center' datatype='1' />				<TD fontIndex='2' leftBorder='1' />			</TR>			<TR height='25' sequence='16'>				<TD fontIndex='4' />				<TD fontIndex='4' topBorder='1' />				<TD fontIndex='4' topBorder='1' />				<TD fontIndex='4' topBorder='1' />				<TD fontIndex='4' topBorder='1' align='center' />				<TD fontIndex='5' />			</TR>		</Table>		<Merges>			<Range row1='0' col1='0' row2='0' col2='5' />			<Range row1='1' col1='1' row2='1' col2='2' />			<Range row1='5' col1='1' row2='5' col2='2' />			<Range row1='9' col1='1' row2='9' col2='2' />			<Range row1='13' col1='1' row2='13' col2='2' />			<Range row1='6' col1='3' row2='6' col2='4' />			<Range row1='7' col1='3' row2='7' col2='4' />			<Range row1='10' col1='2' row2='10' col2='3' />			<Range row1='11' col1='2' row2='11' col2='3' />			<Range row1='14' col1='2' row2='14' col2='3' />			<Range row1='15' col1='2' row2='15' col2='3' />		</Merges>		<PrintPage>			<Paper>				<Margin left='19' top='25' right='19' bottom='25' />			</Paper>			<Page align='center'>				<PageCode>					<Font faceName='宋体' charSet='134' height='-14' weight='400' />				</PageCode>			</Page>		</PrintPage>	</WorkSheet>	<DataSources Version='255' isAutoCalculateWhenOpen='false'		isSaveCalculateResult='false'>		<DataSource type='0'><!-- Desc: Supcan Report Component DataSource				Specification -->			<Data>				<ID>ds1</ID>				<Version>2</Version>				<Type>0</Type>				<TypeMeaning>XML</TypeMeaning>				<Source>data3.xml</Source>				<Memo>订单</Memo>				<XML_RecordAble_Nodes>					<Node>						<name />					</Node>					<Node>						<name alias='客户'>Customer</name>					</Node>					<Node>						<name alias='产品'>Product</name>					</Node>					<Node>						<name alias='子产品'>Product\SubProduct</name>					</Node>				</XML_RecordAble_Nodes>				<Columns>					<Column>						<name>OrderID</name>						<text>订单号</text>						<type>string</type>						<visible>true</visible>						<sequence>1</sequence>					</Column>					<Column>						<name>Desc</name>						<text>说明</text>						<type>string</type>						<visible>true</visible>						<sequence>2</sequence>					</Column>					<Column>						<name>Date</name>						<text>日期</text>						<type>date</type>						<visible>true</visible>						<sequence>3</sequence>					</Column>					<Column>						<name>Log</name>						<text>日志</text>						<type>string</type>						<visible>true</visible>						<sequence>4</sequence>					</Column>					<Column>						<name>Customer\CustID</name>						<text>用户号</text>						<type>string</type>						<visible>true</visible>						<sequence>1</sequence>					</Column>					<Column>						<name>Customer\CustName</name>						<text>用户名</text>						<type>string</type>						<visible>true</visible>						<sequence>2</sequence>					</Column>					<Column>						<name>Customer\Tel</name>						<text>电话</text>						<type>string</type>						<visible>true</visible>						<sequence>3</sequence>					</Column>					<Column>						<name>Product\ProductID</name>						<text>产品号</text>						<type>string</type>						<visible>true</visible>						<sequence>1</sequence>					</Column>					<Column>						<name>Product\SpecID</name>						<text>规格</text>						<type>string</type>						<visible>true</visible>						<sequence>2</sequence>					</Column>					<Column>						<name>Product\Provider</name>						<text>供应商</text>						<type>string</type>						<visible>true</visible>						<sequence>3</sequence>					</Column>					<Column>						<name>Product\SubProduct\code</name>						<text>子产品码</text>						<type>string</type>						<visible>true</visible>						<sequence>1</sequence>					</Column>					<Column>						<name>Product\SubProduct\code_desc</name>						<text>产品规格</text>						<type>string</type>						<visible>true</visible>						<sequence>2</sequence>					</Column>					<Column>						<name>Product\SubProduct\count</name>						<text>数量</text>						<type>decimal</type>						<visible>true</visible>						<sequence>3</sequence>					</Column>				</Columns>			</Data>		</DataSource>		<DataSource type='4'><!-- Desc: Supcan Report Component DataSource				Specification -->			<Data>				<ID>ds233</ID>				<Version>2</Version>				<Type>4</Type>				<TypeMeaning>JSON</TypeMeaning>				<Memo>ewe</Memo>				<XML_RecordAble_Nodes>					<Node>						<name />					</Node>					<Node>						<name alias='子产品s'>pro</name>					</Node>				</XML_RecordAble_Nodes>				<Columns>					<Column>						<name>pro\\pros</name>						<text>pros</text>						<type>string</type>						<visible>true</visible>						<sequence>1</sequence>					</Column>					<Column>						<name>OrderID</name>						<text>OrderID</text>						<type>string</type>						<visible>true</visible>						<sequence>2</sequence>					</Column>				</Columns>			</Data>		</DataSource>	</DataSources></Report>";
		//AF.func("Build", "xmlsheet32.xml");
		AF.func("Build", xml);
		AF.func("CallFunc", "301\r\n3");
	};

	var OnEvent = function(id, Event, p1, p2, p3, p4){
		console.log(arguments);

		if(Event=="Saved"){
			console.log(dojo.byId("AF").func("GetFileXML","false"));
		}
	};

	var loadData = function(){
		var url = "http://localhost:8083/hx/shuozheng/data3.xml";
		AF.func('SetSource', 'ds1\r\n' + url);
		AF.func('Calc', '');
	};

	require(["dojo/data/ItemFileWriteStore"],function($ItemFileWriteStore){
		var data = {
			identifier: 'yw_id',
			label: 'ds_alias',
			items: []
		};
		data.items.push({yw_id:11 ,ds_id:"1", ds_name: "人员列表", ds_alias: "80后人员列表", memo: "关于该数据源业务的描述" });
		data.items.push({yw_id:22 ,ds_id:"2", ds_name: "数据源B", ds_alias: "XXX销售记录", memo: "关于该数据源业务的描述" });
		data.items.push({yw_id:33 ,ds_id:"3", ds_name: "人员列表", ds_alias: "90后人员列表", memo: "关于该数据源业务的描述" });

		test_store = new dojo.data.ItemFileWriteStore({data: data});

	});

	require(["dojo/data/ItemFileWriteStore","dojox/grid/DataGrid"],function($ItemFileWriteStore){
		var data = {
			identifier: 'zdid',
			label: 'zdmc',
			items: []
		};
		data.items.push({zdid:1, zdmc: "f_name", zdmc_alias: "姓名", bm: "1" });
		data.items.push({zdid:2, zdmc: "f_sex", zdmc_alias: "性别", bm: "1" });
		data.items.push({zdid:3, zdmc: "f_age", zdmc_alias: "年龄", bm: "1" });
		data.items.push({zdid:4, zdmc: "f_addr", zdmc_alias: "住址" });
		data.items.push({zdid:5, zdmc: "f_idcard", zdmc_alias: "身份证" });

		test_store2 = new dojo.data.ItemFileWriteStore({data: data});


		gridLayout = {
				defaultCell: { width: 8},
				cells: [
						{ name: 'ID', width: "40px", field: 'zdid' },
						{ name: '字段名', width: "80px", field: 'zdmc', editable: false },
						{ name: '字段别名', width: "100px", field: 'zdmc_alias', editable: true },
						{ name: '显示(是/否)', width: "auto", field: 'bm',type : dojox.grid.cells.Bool,styles: 'text-align: center;',editable: true }
				]
			};

	});

	require(["dojo/data/ItemFileWriteStore"],function($ItemFileWriteStore){
		var data = {
			identifier: 'name',
			label: 'value2',
			items: []
		};
		data.items.push({ name: "sdfsdfsdf", value2: "XXX统计月报" });

		test_store3 = new dojo.data.ItemFileWriteStore({data: data});

	});

	var _reportDesigner = {};

	require([ "dojo/ready",
				"dijit/Menu",
				"dijit/MenuItem",
				"dijit/layout/BorderContainer",
			"dijit/layout/ContentPane", "dijit/form/ValidationTextBox",
			"dijit/form/Button"], function($ready,$Menu,$MenuItem) {



		_reportDesigner.addTreeMenu = function(){
			_reportDesigner.treeMenu = new $Menu({
				style: "display: none;",
				targetNodeIds: [ "_reportDesigner_reportElementObjectTree" ],
				selector: ".dijitTreeNode"
			});

			_reportDesigner.treeMenu.addChild(new $MenuItem({
				label: "添加标签（Label）",
				onClick: function(){
					console.log(this.label);
				}
			}));
			_reportDesigner.treeMenu.addChild(new $MenuItem({
				label: "添加表格（Grid）",
				onClick: function(){
					console.log(this.label);
				}
			}));
			_reportDesigner.treeMenu.addChild(new $MenuItem({
				label: "添加图表（Chart）",
				onClick: function(){
					console.log(this.label);
				}
			}));
		};

		$ready(function() {
			_reportDesigner.addTreeMenu();
		});

	});
</script>
</HEAD>

<BODY class="soria">

	<div data-dojo-id="continentStore"
		data-dojo-type="dojo/data/ItemFileWriteStore"
		data-dojo-props='url:"data2.3/datasource_tree2.json"'></div>
	<div data-dojo-id="continentModel"
		data-dojo-type="dijit/tree/ForestStoreModel"
		data-dojo-props='store:continentStore, query:{type:"continent"},
		rootId:"continentRoot", rootLabel:"报表中的数据源（需讨论改名）", childrenAttrs:["children"]'></div>



	<div data-dojo-id="continentStore2"
		data-dojo-type="dojo/data/ItemFileWriteStore"
		data-dojo-props='url:"data2.3/db_datasource_tree2.json"'></div>
	<div data-dojo-id="continentModel2"
		data-dojo-type="dijit/tree/ForestStoreModel"
		data-dojo-props='store:continentStore2, query:{type:"continent"},
		rootId:"0", rootLabel:"数据库中的数据源（需讨论改名）", childrenAttrs:["children"]'></div>


	<div id="_main" data-dojo-type="dijit.layout.BorderContainer"
		data-dojo-props='liveSplitters:false,design:"headline",splitterClass:"dojox.layout.ToggleSplitter"'>

		<div id="_main_center" data-dojo-type="dijit.layout.ContentPane"
			style="height: 65%"
			data-dojo-props='region:"top",splitter:true,minSize:150'>
			<div style="position: relative; width: 100%; height: 100%">
				<script>
					insertReport('AF', '')
				</script>
			</div>
		</div>


		<div id="_main_left" data-dojo-type="dijit.layout.ContentPane"
			style="width: 15%"
			data-dojo-props='region:"left",splitter:true'>
			<div id="_reportDesigner_reportElementObjectTree" data-dojo-type="fore/Tree" style="margin:-4px;"
				data-dojo-props='model:continentModel2,openOnDblClick:true,  onLoad:function(){ console.log("loaded mytree (first tree)"); }'>

			</div>
		</div>




		<div id="_main_right22" data-dojo-type="dijit.layout.ContentPane"
			style="width: 35%"
			data-dojo-props='region:"center",splitter:true'>

			<table dojoType="dojox/grid/DataGrid" keepSelection="true" style="width:100%;height:100%;margin:-4px;"
				summary="A customized grid summary" id="grid33dsds" store="test_store" query="{ yw_id: '*' }"
				query="{ name: '*' }" rowsPerPage="20"
				rowSelector="20px">
				<thead>
					<tr>
						<th field="ds_name" width="20%">数据源</th>
						<th field="ds_alias" width="20%" editable="true">数据源(别名)</th>
						<th field="memo" width="auto" editable="true">说明(描述)</th>
					</tr>
				</thead>
			</table>
		</div>


		<div id="_main_right" data-dojo-type="dijit.layout.ContentPane"
			style="width: 50%"
			data-dojo-props='region:"right",splitter:true'>
			<div id="iconTabs" data-dojo-type="dijit/layout/TabContainer" data-dojo-props='tabPosition:"bottom"' style="margin:-6px">
				<div id="iconTab2" data-dojo-type="dijit/layout/ContentPane" data-dojo-props='title:"报表字段", showTitle:true, iconClass:"dijitEditorIcon dijitEditorIconCopy"'>
					  <div jsId="grid" class="myGrid" dojoType="dojox/grid/DataGrid" store="test_store2" structure="gridLayout" query="{ zdid: '*' }"
					  		style="width:100%;margin:-4px;"
					  	region="center">
					  </div>
				</div>
				<div id="iconTab1" data-dojo-type="dijit/layout/ContentPane" data-dojo-props='title:"查询参数", tooltip:"tooltip for cut button", showTitle:true, iconClass:"dijitEditorIcon dijitEditorIconCut"'>
					<table dojoType="dojox/grid/DataGrid" keepSelection="true" style="width:100%;margin:-4px;"
						summary="A customized grid summary" jsid="grid2" id="grid2" store="test_store3"
						query="{ name: '*' }" rowsPerPage="20"
						rowSelector="20px">
						<thead>
							<tr>
								<th field="name" width="auto">字段名称</th>
								<th field="type33" width="auto">别名</th>
								<th field="type33" width="auto">显示类型</th>
								<th field="type44" width="auto">控件数据集</th>
								<th field="type55" width="auto">显示</th>
								<th field="type66" width="auto">必填</th>
								<th field="type77" width="auto">默认值</th>
								<th field="type88" width="auto">参数类型</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
	</div>
</BODY>
</HTML>
