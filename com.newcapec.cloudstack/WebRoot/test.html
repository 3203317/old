<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
 <HEAD>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <TITLE>测试</TITLE>
  <META NAME="Generator" CONTENT="EditPlus">
  <META NAME="Author" CONTENT="">
  <META NAME="Keywords" CONTENT="">
  <META NAME="Description" CONTENT="">

    <!-- jQuery -->
    <script src="lib/jquery.js" type="text/javascript"></script>
    <script src="lib/jquery.md5.js" type="text/javascript"></script>
    <script src="lib/jquery.easing.js" type="text/javascript"></script>
    <script src="lib/jquery.validate.js" type="text/javascript"></script>
    <script src="lib/jquery-ui/js/jquery-ui.js" type="text/javascript"></script>

 </HEAD>

 <BODY>
	<table>
		<tr>
			<td><div id="users"></div></td>
			<td>&nbsp;&nbsp;&nbsp;</td>
			<td><form>
				<TABLE border="1">
				<TR style="background:#999666">
					<TD colspan="2">添加帐户</TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>用户名:</TD>
					<TD><INPUT TYPE="text" NAME="username" id="username"></TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>密码:</TD>
					<TD><INPUT TYPE="password" NAME="password" id="password"></TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>电子邮件:</TD>
					<TD><INPUT TYPE="text" NAME="email" id="email"></TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>名字:</TD>
					<TD><INPUT TYPE="text" NAME="firstname" id="firstname"></TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>姓氏:</TD>
					<TD><INPUT TYPE="text" NAME="lastname" id="lastname"></TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>域:</TD>
					<TD><SELECT NAME="domainid" id="domainid"></SELECT></TD>
				</TR>
				<TR>
					<TD>帐户:</TD>
					<TD><INPUT TYPE="text" NAME="account" id="account"></TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>类型:</TD>
					<TD><SELECT NAME="accounttype" id="accounttype">
						<option value="0">User</option>
						<option value="1">Admin</option>
					</SELECT></TD>
				</TR>
				<TR>
					<TD>时区:</TD>
					<TD><SELECT NAME="timezone" id="timezone">
						<option value=""></option>
						<option value="Etc/GMT+12">[UTC-12:00] GMT-12:00</option>
						<option value="Etc/GMT+11">[UTC-11:00] GMT-11:00</option>
						<option value="Pacific/Samoa">[UTC-11:00] Samoa Standard Time</option>
						<option value="Pacific/Honolulu">[UTC-10:00] Hawaii Standard Time</option>
						<option value="US/Alaska">[UTC-09:00] Alaska Standard Time</option>
						<option value="America/Los_Angeles">[UTC-08:00] Pacific Standard Time</option>
						<option value="Mexico/BajaNorte">[UTC-08:00] Baja California</option>
						<option value="US/Arizona">[UTC-07:00] Arizona</option>
						<option value="US/Mountain">[UTC-07:00] Mountain Standard Time</option>
						<option value="America/Chihuahua">[UTC-07:00] Chihuahua, La Paz</option>
						<option value="America/Chicago">[UTC-06:00] Central Standard Time</option>
						<option value="America/Costa_Rica">[UTC-06:00] Central America</option>
						<option value="America/Mexico_City">[UTC-06:00] Mexico City, Monterrey</option>
						<option value="Canada/Saskatchewan">[UTC-06:00] Saskatchewan</option>
						<option value="America/Bogota">[UTC-05:00] Bogota, Lima</option>
						<option value="America/New_York">[UTC-05:00] Eastern Standard Time</option>
						<option value="America/Caracas">[UTC-04:00] Venezuela Time</option>
						<option value="America/Asuncion">[UTC-04:00] Paraguay Time</option>
						<option value="America/Cuiaba">[UTC-04:00] Amazon Time</option>
						<option value="America/Halifax">[UTC-04:00] Atlantic Standard Time</option>
						<option value="America/La_Paz">[UTC-04:00] Bolivia Time</option>
						<option value="America/Santiago">[UTC-04:00] Chile Time</option>
						<option value="America/St_Johns">[UTC-03:30] Newfoundland Standard Time</option>
						<option value="America/Araguaina">[UTC-03:00] Brasilia Time</option>
						<option value="America/Argentina/Buenos_Aires">[UTC-03:00] Argentine Time</option>
						<option value="America/Cayenne">[UTC-03:00] French Guiana Time</option>
						<option value="America/Godthab">[UTC-03:00] Greenland Time</option>
						<option value="America/Montevideo">[UTC-03:00] Uruguay Time]</option>
						<option value="Etc/GMT+2">[UTC-02:00] GMT-02:00</option>
						<option value="Atlantic/Azores">[UTC-01:00] Azores Time</option>
						<option value="Atlantic/Cape_Verde">[UTC-01:00] Cape Verde Time</option>
						<option value="Africa/Casablanca">[UTC] Casablanca</option>
						<option value="Etc/UTC">[UTC] Coordinated Universal Time</option>
						<option value="Atlantic/Reykjavik">[UTC] Reykjavik</option>
						<option value="Europe/London">[UTC] Western European Time</option>
						<option value="CET">[UTC+01:00] Central European Time</option>
						<option value="Europe/Bucharest">[UTC+02:00] Eastern European Time</option>
						<option value="Africa/Johannesburg">[UTC+02:00] South Africa Standard Time</option>
						<option value="Asia/Beirut">[UTC+02:00] Beirut</option>
						<option value="Africa/Cairo">[UTC+02:00] Cairo</option>
						<option value="Asia/Jerusalem">[UTC+02:00] Israel Standard Time</option>
						<option value="Europe/Minsk">[UTC+02:00] Minsk</option>
						<option value="Europe/Moscow">[UTC+03:00] Moscow Standard Time</option>
						<option value="Africa/Nairobi">[UTC+03:00] Eastern African Time</option>
						<option value="Asia/Karachi">[UTC+05:00] Pakistan Time</option>
						<option value="Asia/Kolkata">[UTC+05:30] India Standard Time</option>
						<option value="Asia/Bangkok">[UTC+05:30] Indochina Time</option>
						<option value="Asia/Shanghai">[UTC+08:00] China Standard Time</option>
						<option value="Asia/Kuala_Lumpur">[UTC+08:00] Malaysia Time</option>
						<option value="Australia/Perth">[UTC+08:00] Western Standard Time (Australia)</option>
						<option value="Asia/Taipei">[UTC+08:00] Taiwan</option>
						<option value="Asia/Tokyo">[UTC+09:00] Japan Standard Time</option>
						<option value="Asia/Seoul">[UTC+09:00] Korea Standard Time</option>
						<option value="Australia/Adelaide">[UTC+09:30] Central Standard Time (South Australia)</option>
						<option value="Australia/Darwin">[UTC+09:30] Central Standard Time (Northern Territory)</option>
						<option value="Australia/Brisbane">[UTC+10:00] Eastern Standard Time (Queensland)</option>
						<option value="Australia/Canberra">[UTC+10:00] Eastern Standard Time (New South Wales)</option>
						<option value="Pacific/Guam">[UTC+10:00] Chamorro Standard Time</option>
						<option value="Pacific/Auckland">[UTC+12:00] New Zealand Standard Time</option>
					</SELECT></TD>
				</TR>
				<TR>
					<TD>网络域:</TD>
					<TD><INPUT TYPE="text" NAME="networkdomain" id="networkdomain"></TD>
				</TR>
				<TR>
					<TD colspan="2"><INPUT TYPE="button" onclick="adduser();" value="添加"><INPUT TYPE="reset"></TD>
				</TR>
				</TABLE></form>
			</td>
		</tr>
		<tr>
			<td><div id="domains"></div></td>
			<td>&nbsp;</td>
			<td><form>
				<TABLE border="1">
				<TR style="background:#999666">
					<TD colspan="2">添加域</TD>
				</TR>
				<TR>
					<TD><font color='red'>*</font>域:</TD>
					<TD><INPUT TYPE="text" NAME="name" id="name"></TD>
				</TR>
				<TR>
					<TD colspan="2"><INPUT TYPE="button" onclick="adddomain();" value="添加"><INPUT TYPE="reset"></TD>
				</TR>
				</TABLE></form></td>
		</tr>
	</table>
 </BODY>

<SCRIPT LANGUAGE="JavaScript">
<!--
	function deldomain(id){
		if(id == "55304c32-7d7a-4073-a83c-2d7aa4389026"){
			alert("root 禁止删除");
			return;
		}

		$.ajax({
			type: "post",
			async: false,
			dataType: "json",
			url: "http://192.168.131.91:8081/client/api?command=deleteDomain&id="+ id,
			data: {},
			success:function($data,$textStatus){
				location.reload();

			},
			error:function(){
				location.reload();
			}
		});
	}

	function adddomain(){
		var name = document.getElementById("name").value;

		$.ajax({
			type: "post",
			async: false,
			dataType: "json",
			url: "http://192.168.131.91:8081/client/api?command=createDomain&name="+ name,
			data: {},
			success:function($data,$textStatus){
				location.reload();

			},
			error:function(){
				location.reload();
			}
		});
	}

	function adduser(){
		var username = document.getElementById("username").value;
		var password = document.getElementById("password").value;
		var email = document.getElementById("email").value;
		var firstname = document.getElementById("firstname").value;
		var lastname = document.getElementById("lastname").value;

		var domainid = document.getElementById("domainid").value;
		var account = document.getElementById("account").value;
		var accounttype = document.getElementById("accounttype").value;
		var timezone = document.getElementById("timezone").value;
		var networkdomain = document.getElementById("networkdomain").value;


		//alert(todb = encodeURIComponent); cloud.core.js中
		
		var array1 = [];
		array1.push("&username=" + encodeURIComponent(username));

		var password = password;

		var md5Hashed = true;

		if (md5Hashed)
		  password = $.md5(password);
		array1.push("&password=" + password);

		array1.push("&email=" + encodeURIComponent(email));
		array1.push("&firstname=" + encodeURIComponent(firstname));
		array1.push("&lastname=" + encodeURIComponent(lastname));

		array1.push("&domainid=" + domainid);

		var account = account;
		if(account == null || account.length == 0)
		  account = username;
		array1.push("&account=" + encodeURIComponent(account));

		var accountType = accounttype;							
		if (accounttype == "1" && domainid != rootDomainId) //if account type is admin, but domain is not Root domain
		  accountType = "2"; // Change accounttype from root-domain("1") to domain-admin("2")
		array1.push("&accounttype=" + accountType);

		if(timezone != null && timezone.length > 0)
		  array1.push("&timezone=" + encodeURIComponent(timezone));

		if(networkdomain != null && networkdomain.length > 0)
		  array1.push("&networkdomain=" + encodeURIComponent(networkdomain));

		//alert(array1.join(""));

		array1.push("&response=json");
		
		$.ajax({
			type: "post",
			async: false,
			dataType: "json",
			url: "http://192.168.131.91:8081/client/api?command=createAccount"+ array1.join(""),
			data: {},
			success:function($data,$textStatus){
				location.reload();

			},
			error:function(){
				location.reload();
			}
		});
	}

	$.ajax({
		type: "post",
		async: false,
		dataType: "json",
		url: "http://192.168.131.91:8081/client/api?command=listDomains&response=json&listAll=true",
		data: {},
		success:function($data,$textStatus){
			var __domains = document.getElementById("domains");
			var str = "<table border='1'>";
			str += "<tr style='background:#999666'><td>ID</td> <td>域</td> <td>操作</td></tr>";

			for(var i=0;i<$data.listdomainsresponse.count;i++){
				var __domain = $data.listdomainsresponse.domain[i];
				//alert(__domain.name);

				document.getElementById("domainid").options.add(new Option(__domain.name,__domain.id));

				str += "<tr><td>"+ __domain.id +"</td> <td>"+ __domain.name +"</td> <td><a href='javascript:deldomain(\""+ __domain.id +"\")'>删除</a></td></tr>";
			}
			str += "</table>";

			__domains.innerHTML = str;
		},
		error:function(){
			alert('异常');
		}
	});

	$.ajax({
		type: "post",
		async: false,
		dataType: "json",
		url: "http://192.168.131.91:8081/client/api?command=listAccounts&page=1&pagesize=20&listAll=true&response=json",
		data: {},
		success:function($data,$textStatus){
			//alert($data.listaccountsresponse.count);
			var __users = document.getElementById("users");
			var str = "<table border='1'>";
			str += "<tr style='background:#999666'><td>名称</td> <td>角色</td> <td>域</td> <td>状态</td></tr>";

			for(var i=0;i<$data.listaccountsresponse.count;i++){
				var __account = $data.listaccountsresponse.account[i];
				str += "<tr><td>"+ __account.name +"</td> <td>"+ ((__account.accounttype == 1) ? "Admin" : "User") +"</td> <td>"+ __account.domain +"</td> <td>"+ __account.state +"</td></tr>";
			}

			str += "</table>";

			__users.innerHTML = str;

		},
		error:function(){
			alert('异常');
		}
	});
//-->
</SCRIPT>
</HTML>
